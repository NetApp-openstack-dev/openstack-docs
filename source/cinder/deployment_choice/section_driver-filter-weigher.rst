Theory of Operation: Driver Filter and Weigher for Scheduler
============================================================

Overview
--------

Cinder provides the DriverFilter and GoodnessWeigher to exercise
more fine grained control when choosing a volume backend based
on backend specific properties. It is possible to customize
the backend definition to schedule the creation of Cinder volumes
on specific backends, based on the volume properties and the
backend specific properties. Refer to the ``examples`` section
to take a look at how this would work.

To enable the driver filter, set the ``scheduler_default_filters``
option in the ``cinder.conf`` file to include DriverFilter.

To enable the goodness filter as a weigher, set the
``scheduler_default_weighers`` option in the cinder.conf file to
``GoodnessWeigher`` or add it to the list if other weighers are
already present.

You can choose to use the DriverFilter without the GoodnessWeigher
or vice-versa. The filter and weigher working together, however,
create the most benefits when helping the scheduler choose an
ideal back end.

.. important::

   The GoodnessWeigher can be used along with CapacityWeigher
   and others, but must be used with caution as it might
   obfuscate the CapacityWeigher.

Refer to https://docs.openstack.org/cinder/latest/admin/blockstorage-driver-filter-weighing.html
which contains a more detailed explanation on how to use the driver
filter and goodness weigher to customize the scheduling mechanism.

There exist three property sets that can be referenced in the
``filter_funtion`` and ``goodness_function`` definitions:

. Host stats for a backend: These refer to the parameters
  that are specific for the host containing a defined
  backend. This would be analogous to an ONTAP/SolidFire
  cluster.
  
. Requested volume properties: These statistics are used
  to control scheduling based on the specifications
  of the volume requested during creation.

. Backend specific capabilities: The following table
  contains a list of capabilities reported by the ONTAP
  and SolidFire Cinder drivers.

.. _table-4.99:

+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Property                                | Type      | Products Supported               | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
+=========================================+===========+==================================+==============================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================================+
| ``netapp_aggregate_used_percent``       | String    | ONTAP                            | The percentage of usage for the aggregate.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``utilization``                         | String    | ONTAP                            | Node utilization percentage.                                                                                                                                                                                                                                                                                          																											       																							        |
+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``netapp_dedupe_used_percent``          | String    | ONTAP                            | The percentage of shared block limit that has been consumed by dedupe and cloning operations.                                                                                                                                                                                                          																																																					|
+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``allocated_capacity_gb``               | String    | ONTAP                            | The capacity that has been allocated on the backend pool.                                                                                                                                                                       																																																														|
+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``max_over_subscription_ratio``         | String    | ONTAP                            | The amount of over-provisioning to allow when thin provisioning is being used in the storage pool.                                                                                                                                                                         																																																									|
+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``thin_provision_percent``              | String    | SolidFire                        | The percentage of thin provision.                                                                                                                                                                       																																																																	|
+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``compression_percent``                 | String    | SolidFire                        | The percentage of compression.                                                                                                                                                                        																																																																	|
+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| ``deduplicaton_percent``                | String    | SolidFire                        | The percentage of deduplication.                                                                                                                                                                        																																																																	|
+-----------------------------------------+-----------+----------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

Table 4.99 Backend capabilities reported by ONTAP and SolidFire Cinder drivers
