<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Theory of Operation: Driver Filter and Weigher for Scheduler</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

<!-- Bootstrap CSS -->
<link href="../../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../../_static/css/combined.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="../../_static/bespoke.css" type="text/css" />
<link rel="stylesheet" href="../../_static/sphinxmark.css" type="text/css" />
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-86037601-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>

<!-- SOURCE_FILE: https://github.com/NetApp-openstack-dev/openstack-docs/cinder/deployment_choice/section_driver-filter-weigher.rst -->

 <script type="text/javascript">
    (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
                (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
    })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

    _st('install','aDn5L_vgZ2yzRcE893kK','2.0.0');
</script>
<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="http://netapp.io/openstack"></a>
      </div>
      <div class="search-icon hide"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
         <form class="docs-main-search-form">
    <input type="text" class="st-default-search-input custom-search-box" placeholder="Search OpenStack">
</form>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
           <li>
    <input type="text" class="st-default-search-input custom-search-box-mobile" placeholder="Search OpenStack">
</li>
        </li>
        <li>
          <a class="drop" id="dropdownMenuSoftware">Upstream Docs <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openstack.org/software/start/">Getting Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://developer.openstack.org/">API Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/glance/pike">Glance Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/nova/pike">Nova Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/cinder/pike">Cinder Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/project-install-guide/shared-file-systems/draft/">Manila Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/project-install-guide/object-storage/draft/">Swift Documentation</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Theory of Operation: Driver Filter and Weigher for Scheduler</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="section_over-subscription.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Theory of Operation: Over-Subscription and Thin-Provisioning"></i></a>
    
    
    <a href="section_solidfire-ontap.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Deployment Choices: SolidFire and ONTAP"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2021-05-10 15:21</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Theory of Operation: Driver Filter and Weigher for Scheduler</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <section id="theory-of-operation-driver-filter-and-weigher-for-scheduler">
<h1>Theory of Operation: Driver Filter and Weigher for Scheduler<a class="headerlink" href="#theory-of-operation-driver-filter-and-weigher-for-scheduler" title="Permalink to this headline">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Cinder provides the DriverFilter and GoodnessWeigher to exercise
more fine grained control when choosing a volume backend based
on backend specific properties. It is possible to customize
the backend definition to schedule the creation of Cinder volumes
on specific backends, based on the volume properties and the
backend specific properties. Refer to the
“<a class="reference internal" href="#driver-filter-config"><span class="std std-ref">Configuration</span></a>”
section to take a look at how this would work.</p>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>To enable the driver filter, set the <code class="docutils literal notranslate"><span class="pre">scheduler_default_filters</span></code>
option in the <code class="docutils literal notranslate"><span class="pre">[DEFAULT]</span></code> section of the <code class="docutils literal notranslate"><span class="pre">cinder.conf</span></code> file
to include DriverFilter.</p>
<p>To enable the goodness filter as a weigher, set the
<code class="docutils literal notranslate"><span class="pre">scheduler_default_weighers</span></code> option in the <code class="docutils literal notranslate"><span class="pre">[DEFAULT]</span></code> section
of the <code class="docutils literal notranslate"><span class="pre">cinder.conf</span></code> file to <code class="docutils literal notranslate"><span class="pre">GoodnessWeigher</span></code> or add it to
the list if other weighers are already present.</p>
<p>Example <code class="docutils literal notranslate"><span class="pre">cinder.conf</span></code> configuration file:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[DEFAULT]</span>
<span class="na">scheduler_default_filters</span> <span class="o">=</span> <span class="s">DriverFilter,AvailabilityFilter,CapabilityFilter,CapacityFilter</span>
<span class="na">scheduler_default_weighers</span> <span class="o">=</span> <span class="s">GoodnessWeigher</span>
</pre></div>
</div>
<p>You can choose to use the DriverFilter without the GoodnessWeigher
or vice-versa. The filter and weigher working together, however,
create the most benefits when helping the scheduler choose an
ideal back end.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The GoodnessWeigher can be used along with CapacityWeigher
and others, but must be used with caution as it might
obfuscate the CapacityWeigher.</p>
</div>
<p>Refer to
<a class="reference external" href="https://docs.openstack.org/cinder/latest/admin/blockstorage-driver-filter-weighing.html">Upstream Driver Filter
Weighing</a>
which contains a more detailed explanation on how to use the driver
filter and goodness weigher to customize the scheduling mechanism.</p>
<p>There exist three property sets that can be referenced in the
<code class="docutils literal notranslate"><span class="pre">filter_funtion</span></code> and <code class="docutils literal notranslate"><span class="pre">goodness_function</span></code> definitions:</p>
<ul class="simple">
<li><p><strong>Host stats for a backend</strong>: These refer to the parameters
that are specific for the host containing a defined
backend. This would be analogous to an ONTAP/SolidFire
cluster. They can be invoked as <code class="docutils literal notranslate"><span class="pre">stats.&lt;property&gt;</span></code>.
For example: <code class="docutils literal notranslate"><span class="pre">stats.allocated_capacity_gb</span></code>.
“<a class="reference internal" href="#table-4-12"><span class="std std-ref">Table 4.12</span></a>” lists the
host stats that can be used for ONTAP and SolidFire systems.</p></li>
</ul>
<table class="docutils align-default" id="table-4-12">
<colgroup>
<col style="width: 5%" />
<col style="width: 1%" />
<col style="width: 4%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Products Supported</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">host</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The name of the host.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">volume_backend_name</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The volume backend name as defined in <code class="docutils literal notranslate"><span class="pre">cinder.conf</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">vendor_name</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The name of the vendor. For ONTAP systems, this is <code class="docutils literal notranslate"><span class="pre">NetApp</span></code>. For SolidFire systems, this is <code class="docutils literal notranslate"><span class="pre">SolidFire</span> <span class="pre">Inc</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">driver_version</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The Cinder driver version.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">storage_protocol</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The storage protocol supported. For ONTAP pools, this depends on the protocol enabled for the storage pool (can be iSCSI, NFS or FC). For SolidFire pools, this is <code class="docutils literal notranslate"><span class="pre">iSCSI</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">QoS_support</span></code></p></td>
<td><p>Boolean</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>Boolean signifying whether QoS is supported. This is reported as <code class="docutils literal notranslate"><span class="pre">True</span></code> for ONTAP and SolidFire systems.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">total_capacity_gb</span></code></p></td>
<td><p>Float</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The total capacity of each pool in GB.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">allocated_capacity_gb</span></code></p></td>
<td><p>Float</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The capacity that has been allocated for Cinder volumes on the cluster. This value is reported in GB.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">free_capacity_gb</span></code></p></td>
<td><p>Float</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The amount of free capacity of each pool in GB.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">reserved_percentage</span></code></p></td>
<td><p>Float</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The reserved percentage for each pool. This specifies how much space is to be reduced from total_capacity when performing over subscription calculations.</p></td>
</tr>
</tbody>
</table>
<p>Table 4.12 Host statistics for ONTAP and SolidFire systems</p>
<ul class="simple">
<li><p><strong>Requested volume properties</strong>: These statistics are used
to control scheduling based on the specifications
of the volume requested during creation. These parameters
can be referenced as <code class="docutils literal notranslate"><span class="pre">volume.&lt;property&gt;</span></code>. For example,
the size of the requested volume is returned by <code class="docutils literal notranslate"><span class="pre">volume.size</span></code>.
“<a class="reference internal" href="#table-4-13"><span class="std std-ref">Table 4.13</span></a>” contains a list of statistics
that can be queried from a volume request. These
statistics would be supported for all NetApp backends.</p></li>
</ul>
<table class="docutils align-default" id="table-4-13">
<colgroup>
<col style="width: 5%" />
<col style="width: 95%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">size</span></code></p></td>
<td><p>The size of the volume requested.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">volume_type_id</span></code></p></td>
<td><p>The UUID of the volume type.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">display_name</span></code></p></td>
<td><p>Name of the volume.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">volume_metadata</span></code></p></td>
<td><p>Metadata associated with the volume.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">user_id</span></code></p></td>
<td><p>User ID of the user that creates the volume.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">display_description</span></code></p></td>
<td><p>Display description for the volume.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source_volid</span></code></p></td>
<td><p>ID of the source volume, if the volume is cloned.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">reservations</span></code></p></td>
<td><p>Any reservation the volume has.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">attach_status</span></code></p></td>
<td><p>The attach status for the volume.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">id</span></code></p></td>
<td><p>The volume’s ID.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">replication_status</span></code></p></td>
<td><p>The volume’s replication status.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">snapshot_id</span></code></p></td>
<td><p>The volume’s snapshot ID.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">encryption_key_id</span></code></p></td>
<td><p>The volume’s encryption key ID.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">volume_admin_metadata</span></code></p></td>
<td><p>Any admin metadata for this volume.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">source_replicaid</span></code></p></td>
<td><p>The source replication ID.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">consistencygroup_id</span></code></p></td>
<td><p>The consistency group ID.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">metadata</span></code></p></td>
<td><p>General metadata.</p></td>
</tr>
</tbody>
</table>
<p>Table 4.13 Volume properties available for Filter and Goodness functions</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The most commonly used <code class="docutils literal notranslate"><span class="pre">volume.&lt;property&gt;</span></code> is <code class="docutils literal notranslate"><span class="pre">volume.size</span></code>. This enables
admins to schedule volume placement based on the size of the volume that is
requested.</p>
</div>
<ul class="simple">
<li><p><strong>Backend specific capabilities</strong>: The following table
contains a list of capabilities reported by the ONTAP
and SolidFire Cinder drivers.</p></li>
</ul>
<table class="docutils align-default" id="table-4-14">
<colgroup>
<col style="width: 5%" />
<col style="width: 1%" />
<col style="width: 4%" />
<col style="width: 89%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Property</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Products Supported</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">netapp_aggregate_used_percent</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP</p></td>
<td><p>The percentage of usage for the aggregate.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">utilization</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP</p></td>
<td><p>Node utilization percentage per pool (FlexVol).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">netapp_dedupe_used_percent</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP</p></td>
<td><p>The percentage of shared block limit that has been consumed by dedupe and cloning operations.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_over_subscription_ratio</span></code></p></td>
<td><p>String</p></td>
<td><p>ONTAP,SolidFire</p></td>
<td><p>The over-provisioning factor when thin provisioning is being used in the storage pool.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">thin_provision_percent</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>The percentage of thin provisioning performed on the SolidFire cluster.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">compression_percent</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>The percentage of compression performed on the SolidFire cluster.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">deduplicaton_percent</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>The percentage of deduplication achieved on the SolidFire cluster.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">provisioned_capacity_gb</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>Amount of capacity that has been provisioned on the entire SolidFire cluster (not limited to storage consumed by Cinder volumes). Reported in GB.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">provisioned_iops</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>The amount of provisioned IOPS for the entire SolidFire cluster.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">current_iops</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>Current active IOPS for the entire SolidFire cluster.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">average_iops</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>Average IOPS returned for the entire SolidFire cluster.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">max_iops</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>Maximum IOPS value for the SolidFire cluster.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">peak_iops</span></code></p></td>
<td><p>String</p></td>
<td><p>SolidFire</p></td>
<td><p>Peak IOPS value for the SolidFire cluster.</p></td>
</tr>
</tbody>
</table>
<p>Table 4.14 Backend capabilities reported by ONTAP and SolidFire Cinder drivers</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>To utilize the driver filter and goodness weigher, update the
<code class="docutils literal notranslate"><span class="pre">scheduler_default_filters</span></code> and <code class="docutils literal notranslate"><span class="pre">scheduler_default_weighers</span></code>
options in <code class="docutils literal notranslate"><span class="pre">cinder.conf</span></code>. The required <code class="docutils literal notranslate"><span class="pre">filter_function</span></code>
and <code class="docutils literal notranslate"><span class="pre">goodness_function</span></code> are defined on a per-backend basis
as shown below.</p>
<p id="driver-filter-config"><strong>Example1: Using Driver Filter</strong></p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">.</span>
<span class="na">.</span>
<span class="na">scheduler_default_filters</span> <span class="o">=</span> <span class="s">DriverFilter,AvailabilityFilter,CapabilityFilter,CapacityFilter</span>
<span class="na">scheduler_default_weighers</span> <span class="o">=</span> <span class="s">GoodnessWeigher</span>
<span class="na">enabled_backends</span> <span class="o">=</span> <span class="s">ontap-iscsi-1,ontap-iscsi-2</span>
<span class="na">.</span>
<span class="na">.</span>
<span class="k">[ontap-iscsi-1]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.netapp.common.NetAppDriver</span>
<span class="na">netapp_login</span> <span class="o">=</span> <span class="s">admin</span>
<span class="na">netapp_password</span> <span class="o">=</span> <span class="s">*********</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">ontap-iscsi</span>
<span class="na">netapp_server_hostname</span> <span class="o">=</span> <span class="s">192.168.0.101</span>
<span class="na">netapp_server_port</span> <span class="o">=</span> <span class="s">80</span>
<span class="na">netapp_transport_type</span> <span class="o">=</span> <span class="s">http</span>
<span class="na">netapp_vserver</span> <span class="o">=</span> <span class="s">svm1</span>
<span class="na">netapp_storage_protocol</span> <span class="o">=</span> <span class="s">iscsi</span>
<span class="na">netapp_storage_family</span> <span class="o">=</span> <span class="s">ontap_cluster</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;volume.size &lt; 5&quot;</span>

<span class="k">[ontap-iscsi-2]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.netapp.common.NetAppDriver</span>
<span class="na">netapp_login</span> <span class="o">=</span> <span class="s">admin</span>
<span class="na">netapp_password</span> <span class="o">=</span> <span class="s">*********</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">ontap-iscsi</span>
<span class="na">netapp_server_hostname</span> <span class="o">=</span> <span class="s">192.168.0.102</span>
<span class="na">netapp_server_port</span> <span class="o">=</span> <span class="s">80</span>
<span class="na">netapp_transport_type</span> <span class="o">=</span> <span class="s">http</span>
<span class="na">netapp_vserver</span> <span class="o">=</span> <span class="s">svm2</span>
<span class="na">netapp_storage_protocol</span> <span class="o">=</span> <span class="s">iscsi</span>
<span class="na">netapp_storage_family</span> <span class="o">=</span> <span class="s">ontap_cluster</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;volume.size &gt;= 5 and capabilities.netapp_aggregate_used_percent &lt; 45&quot;</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">cinder.conf</span></code> file will schedule the creation of volumes as follows:</p>
<ul class="simple">
<li><p>Cinder volumes that are of size &lt; 5GB will be placed on the <code class="docutils literal notranslate"><span class="pre">ontap-iscsi-1</span></code>
backend.</p></li>
<li><p>Cinder volumes that are of size &gt;= 5GB will be placed on the <code class="docutils literal notranslate"><span class="pre">ontap-iscsi-2</span></code>
backend, if the aggregate has a usage percent of lesser than 45%. Otherwise,
volume creation will fail.</p></li>
</ul>
<p><strong>Example2: Using Goodness Weigher</strong></p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">.</span>
<span class="na">.</span>
<span class="na">scheduler_default_filters</span> <span class="o">=</span> <span class="s">DriverFilter,AvailabilityFilter,CapabilityFilter,CapacityFilter</span>
<span class="na">scheduler_default_weighers</span> <span class="o">=</span> <span class="s">GoodnessWeigher</span>
<span class="na">enabled_backends</span> <span class="o">=</span> <span class="s">ontap-iscsi-1,ontap-iscsi-2</span>
<span class="na">.</span>
<span class="na">.</span>
<span class="k">[ontap-iscsi-1]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.netapp.common.NetAppDriver</span>
<span class="na">netapp_login</span> <span class="o">=</span> <span class="s">admin</span>
<span class="na">netapp_password</span> <span class="o">=</span> <span class="s">*********</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">ontap-iscsi</span>
<span class="na">netapp_server_hostname</span> <span class="o">=</span> <span class="s">192.168.0.101</span>
<span class="na">netapp_server_port</span> <span class="o">=</span> <span class="s">80</span>
<span class="na">netapp_transport_type</span> <span class="o">=</span> <span class="s">http</span>
<span class="na">netapp_vserver</span> <span class="o">=</span> <span class="s">svm1</span>
<span class="na">netapp_storage_protocol</span> <span class="o">=</span> <span class="s">iscsi</span>
<span class="na">netapp_storage_family</span> <span class="o">=</span> <span class="s">ontap_cluster</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(capabilities.utilization &lt; 60.0) ? 60 : 30&quot;</span>

<span class="k">[ontap-iscsi-2]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.netapp.common.NetAppDriver</span>
<span class="na">netapp_login</span> <span class="o">=</span> <span class="s">admin</span>
<span class="na">netapp_password</span> <span class="o">=</span> <span class="s">*********</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">ontap-iscsi</span>
<span class="na">netapp_server_hostname</span> <span class="o">=</span> <span class="s">192.168.0.102</span>
<span class="na">netapp_server_port</span> <span class="o">=</span> <span class="s">80</span>
<span class="na">netapp_transport_type</span> <span class="o">=</span> <span class="s">http</span>
<span class="na">netapp_vserver</span> <span class="o">=</span> <span class="s">svm2</span>
<span class="na">netapp_storage_protocol</span> <span class="o">=</span> <span class="s">iscsi</span>
<span class="na">netapp_storage_family</span> <span class="o">=</span> <span class="s">ontap_cluster</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;(capabilities.utilization &lt; 60.0) ? 75 : 25&quot;</span>
</pre></div>
</div>
<p>In this example, the <code class="docutils literal notranslate"><span class="pre">goodness_function</span></code> is set for the available
backends. For every volume request, the goodness function is
calculated and used as follows:</p>
<ul class="simple">
<li><p>If the node utilization for both backends <code class="docutils literal notranslate"><span class="pre">ontap-iscsi-1</span></code> and
<code class="docutils literal notranslate"><span class="pre">ontap-iscsi-2</span></code> are lesser than 60%, the goodness weigher is
set to 60 and 75 respectively. <code class="docutils literal notranslate"><span class="pre">ontap-iscsi-2</span></code> would be preferred
for the Cinder volume.</p></li>
<li><p>If the node utilization for <code class="docutils literal notranslate"><span class="pre">ontap-iscsi-1</span></code> is greater than 60%
and is lesser than 60 % for <code class="docutils literal notranslate"><span class="pre">ontap-iscsi-2</span></code>, the good weigher is
higher (75%) for <code class="docutils literal notranslate"><span class="pre">ontap-iscsi-2</span></code> than for <code class="docutils literal notranslate"><span class="pre">ontap-iscsi-1</span></code> (30%).</p></li>
<li><p>If both backends have node utilization greater than 60%, then
<code class="docutils literal notranslate"><span class="pre">ontap-iscsi-1</span></code> would be preferred as it has a higher goodness
weigher value (30 over 25)</p></li>
</ul>
<p><strong>Example3: Using Driver Filter and Goodness Weigher</strong></p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[default]</span>
<span class="na">.</span>
<span class="na">.</span>
<span class="na">scheduler_default_filters</span> <span class="o">=</span> <span class="s">DriverFilter,AvailabilityFilter,CapabilityFilter</span>
<span class="na">scheduler_default_weighers</span> <span class="o">=</span> <span class="s">GoodnessWeigher</span>
<span class="na">enabled_backends</span> <span class="o">=</span> <span class="s">sf-1,sf-2</span>
<span class="na">.</span>
<span class="na">.</span>
<span class="k">[sf-1]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.solidfire.SolidFireDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">sf-backend</span>
<span class="na">san_login</span> <span class="o">=</span> <span class="s">admin</span>
<span class="na">san_ip</span> <span class="o">=</span> <span class="s">192.168.0.101</span>
<span class="na">san_password</span> <span class="o">=</span> <span class="s">*************</span>
<span class="na">filter_function</span> <span class="o">=</span> <span class="s">&quot;(stats.allocated_capacity_gb + volume.size) &lt; (stats.total_capacity_gb * 10.0)&quot;</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;((stats.allocated_capacity_gb) / (stats.total_capacity_gb) * 100 &lt; 60.0) ? 60 : 30&quot;</span>

<span class="k">[sf-2]</span>
<span class="na">volume_driver</span> <span class="o">=</span> <span class="s">cinder.volume.drivers.solidfire.SolidFireDriver</span>
<span class="na">volume_backend_name</span> <span class="o">=</span> <span class="s">sf-backend</span>
<span class="na">san_login</span> <span class="o">=</span> <span class="s">admin</span>
<span class="na">san_ip</span> <span class="o">=</span> <span class="s">192.168.0.102</span>
<span class="na">san_password</span> <span class="o">=</span> <span class="s">*************</span>
<span class="na">goodness_function</span> <span class="o">=</span> <span class="s">&quot;((capabilities.max_iops - capabilities.average_iops)/capabilities.max_iops) * 100&quot;</span>
</pre></div>
</div>
<p>This example shows how the <code class="docutils literal notranslate"><span class="pre">filter_function</span></code> and <code class="docutils literal notranslate"><span class="pre">goodness_function</span></code>
can be combined together. The <code class="docutils literal notranslate"><span class="pre">filter_function</span></code> for <code class="docutils literal notranslate"><span class="pre">sf-1</span></code>
evaluates if creating a requested volume can be performed without
exceeding <code class="docutils literal notranslate"><span class="pre">10</span> <span class="pre">*</span> <span class="pre">total</span> <span class="pre">capacity</span></code>.</p>
<ul class="simple">
<li><p>If this check passes, the <code class="docutils literal notranslate"><span class="pre">goodness_function</span></code> is evaluated for
both backends based on node utilization. The backend with the higher value
is ultimately selected.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">filter_function</span></code> check fails, the Driver Filter returns only
one host, <code class="docutils literal notranslate"><span class="pre">sf-2</span></code>. The Goodness Weigher is calculated and the
Cinder volume is placed on <code class="docutils literal notranslate"><span class="pre">sf-2</span></code>.</p></li>
</ul>
</section>
</section>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="section_over-subscription.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Theory of Operation: Over-Subscription and Thin-Provisioning"></i></a>
          
          
            <a href="section_solidfire-ontap.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Deployment Choices: SolidFire and ONTAP"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2021-05-10 15:21</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<p>
 This document is licensed under
 <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://netapp.io/slack/" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
<a href="../../index.html">
  <button href="#" type="button"
          class="btn docs-sidebar-release-select">NetApp OpenStack Docs 2021.2</button>
</a>

  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <h4></h4>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ch_executive-summary.html">Executive Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_openstack-overview.html">OpenStack Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_netapp-storage.html">NetApp Systems and Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/appendix_packaging.html">Installing OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_glance-image-service.html">Image Service (Glance)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_nova.html">Compute Service (Nova)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../ch_cinder.html">Block Storage (Cinder)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/section_cinder-overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../key_concepts/section_cinder-key-concepts.html">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process_structure/section_cinder-processes.html">Process Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_overview/section_cinder-api-overview.html">API Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../ch_cinder-theory-and-deployment-choices.html">Theory of Operation and Deployment Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch_cinder-configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch_cinder-examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_manila.html">Shared Filesystems (Manila)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_swift.html">Object Storage (Swift)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_operations.html">Day two operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_appendix.html">Appendix</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>NetApp Resources</h3>
        <ul>
          <li><a href="http://netapp.io/openstack/#resources">NetApp OpenStack Resources</a></li>
          <li><a href="http://docs.netapp.com">NetApp documentation</a></li>
          <li><a href="http://www.netapp.com/us/media/tr-4620.pdf">NetApp SolidFire Storage Config Guide</a></li>
          <li><a href="https://mysupport.netapp.com/">NetApp Support</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>News</h3>
        <ul>
          <li><a href="http://netapp.io/blog/">Netapp's thePub</a></li>
          <li><a href="http://planet.openstack.org/">Community Blog</a></li>
          <li><a href="http://openstack.org/news/">Community News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Social Media</h3>
        <ul>
          <li><a href="https://www.github.com/netapp">GitHub</a></li>
          <li><a href="http://netapp.io/slack">Slack</a></li>
          <li><a href="https://twitter.com/@openstacknetapp">Twitter @openstacknetapp</a></li>
          <li><a href="https://www.youtube.com/user/NetAppTV">Youtube NetAppTV</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Legal</h3>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../../_static/js/jquery-3.1.1.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "cinder/deployment_choice/section_driver-filter-weigher" + ".rst";
        gitURL = "Source: https://github.com/NetApp-openstack-dev/openstack-docs" + "/" + sourceFile;

    /* gitsha, project, bug_tag and watermark rely on variables in conf.py */
    var gitSha = "SHA: a5634f19e00fad9d93c1de09af61756721ec9c5a";
        var bugProject = "NetApp-openstack-dev/openstack-docs";
        var bugTitle = "Theory of Operation: Driver Filter and Weigher for Scheduler in NetApp OpenStack Docs";
    var fieldTags = "docs, dog";
    var watermark = "WALLABY"
        var useStoryboard = "";


    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 2021.2 on 2021-05-10 15:21";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, watermark);
</script>

<script src="../../_static/documentation_options.js" type="text/javascript"></script>
  </body>
</html>