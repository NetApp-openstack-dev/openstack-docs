<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"/>

    <title>OpenStack Docs: Deployment Choices: NFS Security</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Bootstrap CSS -->
<link href="../../_static/css/bootstrap.css" rel="stylesheet">

<!-- Pygments CSS -->
<link href="../../_static/css/native.css" rel="stylesheet">

<!-- Fonts -->
<link href="../../_static/css/font-awesome.css" rel="stylesheet">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>

<!-- Custom CSS -->
<link href="../../_static/css/combined.css" rel="stylesheet">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" href="../../_static/bespoke.css" type="text/css" />
<link rel="stylesheet" href="../../_static/sphinxmark.css" type="text/css" />
  


<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-86037601-2', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

  </head>
  <body>

<!-- SOURCE_FILE: https://github.com/NetApp-openstack-dev/openstack-docs/cinder/deployment_choice/section_nfs-security.rst -->

 <script type="text/javascript">
    (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
                (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
    })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

    _st('install','aDn5L_vgZ2yzRcE893kK','2.0.0');
</script>
<nav class="navbar navbar-default" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button class="navbar-toggle" data-target="#bs-example-navbar-collapse-1" data-toggle="collapse" type="button">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="brand-wrapper">
        <a class="navbar-brand" href="http://netapp.io/openstack"></a>
      </div>
      <div class="search-icon hide"><i class="fa fa-search"></i> Search</div></div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <div class="search-container tiny">
         <form class="docs-main-search-form">
    <input type="text" class="st-default-search-input custom-search-box" placeholder="Search OpenStack">
</form>
        <i class="fa fa-times close-search"></i>
      </div>
      <ul class="nav navbar-nav navbar-main show">
        <li>
           <li>
    <input type="text" class="st-default-search-input custom-search-box-mobile" placeholder="Search OpenStack">
</li>
        </li>
        <li>
          <a class="drop" id="dropdownMenuSoftware">Upstream Docs <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenuSoftware">
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openstack.org/software/start/">Getting Started</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://openstack.org/projects/openstack-faq/">Common Questions</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://developer.openstack.org/">API Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/glance/pike">Glance Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/nova/pike">Nova Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/cinder/pike">Cinder Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/project-install-guide/shared-file-systems/draft/">Manila Documentation</a></li>
            <li role="presentation"><a role="menuitem" tabindex="-1" href="https://docs.openstack.org/project-install-guide/object-storage/draft/">Swift Documentation</a></li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  <!-- /.container -->
</nav>
    <div class="container docs-book-wrapper">
      <div class="row">
        <div class="col-lg-9 col-md-8 col-sm-8 col-lg-push-3 col-md-push-4 col-sm-push-4">
<div class="row">
  <div class="col-lg-8">
      <h2>Deployment Choices: NFS Security</h2>
    
  </div>
  <div class="docs-actions">
    
    <a href="section_vg-v-ddp.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Deployment Choices: Volume Groups vs. Dynamic Disk Pools (E-Series)"></i></a>
    
    
    <a href="section_unidirectional-chap.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Deployment Choices: Unidirectional CHAP Authentication"></i></a>
    
    <a id="logABugLink1" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
    
  </div>
</div>
          <div class="row docs-byline">
            <div class="docs-updated">updated: 2018-07-12 13:54</div>
          </div>
          <div class="row">
            <div class="col-lg-12">
              <div class="docs-top-contents">

<h5><a href="../../index.html">Contents</a></h5>
<ul>
<li><a class="reference internal" href="#">Deployment Choices: NFS Security</a><ul>
<li><a class="reference internal" href="#options">Options</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#ontap-setup">ONTAP Setup</a></li>
<li><a class="reference internal" href="#openstack-setup">OpenStack Setup</a></li>
<li><a class="reference internal" href="#nfs-security-checklists">NFS Security Checklists</a><ul>
<li><a class="reference internal" href="#how-to-enable-nfs-security">How to Enable NFS Security</a></li>
<li><a class="reference internal" href="#how-to-disable-nfs-security">How to Disable NFS Security</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
              <div class="docs-body">

  <div class="section" id="deployment-choices-nfs-security">
<span id="nfs-security"></span><h1>Deployment Choices: NFS Security<a class="headerlink" href="#deployment-choices-nfs-security" title="Permalink to this headline">¶</a></h1>
<div class="section" id="options">
<h2>Options<a class="headerlink" href="#options" title="Permalink to this headline">¶</a></h2>
<p>Starting with the Kilo release of OpenStack, two NAS security options,
<code class="docutils literal notranslate"><span class="pre">nas_secure_file_operations</span></code> and <code class="docutils literal notranslate"><span class="pre">nas_secure_file_permissions</span></code>, were
introduced to improve NFS security.</p>
<p>The Cinder design assumes that the connections from OpenStack nodes to NFS
backends use trusted physical networks. Also, OpenStack services are assumed
to run on dedicated nodes whose processes are trusted. Exposure of storage
resources to tenants is mediated by the hypervisor under control of Cinder
and Nova. Prior to the introduction of the two NAS security options, operations
on the backing files, for Cinder volumes, only ran as <em>root</em> and the files
themselves were readable and writable by any user on OpenStack nodes that
mounted the NFS backend shares.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Consult with the OpenStack distribution documentation to determine
supportability of this feature.</p>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="3%" />
<col width="5%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Type</th>
<th class="head">Default Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">nas_secure_file_operations</span></code></td>
<td>Optional</td>
<td>“auto”</td>
<td>Run operations on backing files for Cinder volumes as <em>cinder</em> user rather than <em>root</em> if ‘True’; as <em>root</em> if ‘False’. If ‘auto’, run as ‘True’ if in a “greenfield” environment and run as ‘False’ if existing volumes are found on startup.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">nas_secure_file_permissions</span></code></td>
<td>Optional</td>
<td>“auto”</td>
<td>Create backing files for Cinder volumes to only be readable and writable by owner and group if ‘True’; as readable and writable by owner, group, and world if ‘False’. If ‘auto’, run as ‘True’ if in a “greenfield” environment and run as ‘False’ if existing volumes are found on startup.</td>
</tr>
</tbody>
</table>
<p>Table 4.10. Configuration options for NFS Security</p>
<p>When <code class="docutils literal notranslate"><span class="pre">nas_secure_file_operations</span></code> is set to ‘true’, Cinder operations run as
the dedicated <em>cinder</em> user rather than as <em>root</em>.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">nas_secure_file_permissions</span></code> is set to ‘true’, backing files for
Cinder volumes are only readable and writable by owner and group (mode 0660
rather than 0666). Since Cinder creates these files with both owner and group
<em>cinder</em>, only system processes running with UID or GID <em>cinder</em> are allowed
to read or write these files.</p>
<p>When both <code class="docutils literal notranslate"><span class="pre">nas_secure_file_operations</span></code> and <code class="docutils literal notranslate"><span class="pre">nas_secure_file_permissions</span></code>
are set to ‘true’ setting the <em>Superuser Security Type</em> (also known as
“root squash”) to none on the ONTAP export policy is recommended.</p>
<p>The default value of both of these options is ‘auto’. For backwards
compatibility, if cinder volumes already exist when Cinder starts
up and the value of one of these options is ‘auto’, it is set to ‘false’
internally. If no cinder volumes already exist, a greenfield environment,
the option is set to ‘true’ and a marker file <em>.cinderSecureEnvIndicator</em>
is created under the mount directory. On startup, the marker file is
checked so that the ‘true’ option will be persisted for subsequent
startups after volumes have been created. It is recommended that the
<code class="docutils literal notranslate"><span class="pre">nas_secure_file_operations</span></code> and <code class="docutils literal notranslate"><span class="pre">nas_secure_file_permissions</span></code> are
both specified in the <code class="docutils literal notranslate"><span class="pre">/etc/cinder.conf</span></code> as either ‘true’ or ‘false’.</p>
</div>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>When NAS security options are enabled, OpenStack Cinder, Nova, and Glance
nodes, as well as Data ONTAP, must be configured appropriately for OpenStack
operations to succeed. If not configured appropriately read and write
operations of the backing files will fail.</p>
<p>The objective of enabling NFS security options is to limit read and write
permissions of the backing file for cinder volumes to only the cinder user’s
UID and GID.</p>
</div>
<div class="section" id="ontap-setup">
<h2>ONTAP Setup<a class="headerlink" href="#ontap-setup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>If you are using an identity service (i.e. NIS, LDAP, etc…) with ONTAP,
ensure that there are <em>cinder</em>, <em>nova</em>, and <em>glance</em> user and group
identities with <em>UID</em> and <em>GID</em> that match the corresponding users on the
OpenStack Cinder, Nova, and Glance nodes. See <a class="reference external" href="http://www.netapp.com/us/media/tr-4067.pdf">NetApp TR4067: Clustered Data
ONTAP NFS Best Practice and Implementation Guide</a> for additional information.</li>
<li>In ONTAP, put the <em>cinder</em>, <em>nova</em>, and <em>glance</em> users in the <em>cinder</em> group.
It is recommended to use OnCommand System Manager when creating SVM users
to avoid mistakes.</li>
<li>Ensure that the exported ONTAP volume has owner <em>cinder</em> and group <em>cinder</em>.</li>
<li>Set permissions on the exported share to 0755.</li>
<li>Disable <code class="docutils literal notranslate"><span class="pre">Superuser</span> <span class="pre">Security</span> <span class="pre">Type</span></code> (i.e. root squash) and <code class="docutils literal notranslate"><span class="pre">SetUID</span></code> access
in export policies.</li>
<li>See <a class="reference external" href="http://www.netapp.com/us/media/tr-3580.pdf">NetApp TR3850: NFSv4 Enhancements and Best Practices Guide: Data
ONTAP Implementation</a>
and <a class="reference external" href="http://www.netapp.com/us/media/tr-4067.pdf">NetApp TR4067: Clustered Data ONTAP NFS Best Practice and
Implementation Guide</a>,
as well as the File Access and Protocols Management Guides available
from the NetApp NOW site for additional setup information.</li>
</ul>
</div>
<div class="section" id="openstack-setup">
<h2>OpenStack Setup<a class="headerlink" href="#openstack-setup" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>For NFSv4 only, set the <em>Domain</em> in <em>/etc/idmapd.conf</em> on both storage and
compute nodes to match that of the NFS server. Restart idmapd service.</li>
<li>On Nova nodes, add the <em>nova</em> user to the <em>cinder</em> group.</li>
<li>On Nova nodes, set “user = ‘nova’”, “group = ‘cinder’”, and
“dynamic_ownership = 0” in <em>/etc/libvirt/qemu.conf</em>.</li>
<li>On Nova nodes, restart libvirt, qemu, and kvm processes or reboot the
hypervisor. Also, restart Nova services.</li>
</ul>
</div>
<div class="section" id="nfs-security-checklists">
<h2>NFS Security Checklists<a class="headerlink" href="#nfs-security-checklists" title="Permalink to this headline">¶</a></h2>
<p>The following checklists can be used as a reference to disable or enable NAS
security. Some commands may differ based on the version of Linux being used.
Disabling or enabling NAS security is disruptive to OpenStack processes.</p>
<div class="section" id="how-to-enable-nfs-security">
<h3>How to Enable NFS Security<a class="headerlink" href="#how-to-enable-nfs-security" title="Permalink to this headline">¶</a></h3>
<p>The following checklist provides a reference for enabling NFS security. Be
advised that some of the commands, shown in the examples, may differ depending
on your environment.</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="80%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">#</th>
<th class="head">Description of Step</th>
<th class="head">Done?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Cinder: Change NAS security options</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>Cinder: Determine cinder user’s UID and GID</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Nova &amp; Glance: Add users to cinder group</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>QEMU: Change QEMU configuration</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Idmapd: Edit the Domain setting (NFSv4.x only)</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>6</td>
<td>ONTAP: Add nova, glance, and cinder users to cinder GID</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>7</td>
<td>ONTAP: Disable superuser access in export policy</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>8</td>
<td>ONTAP: Set exported Flexvol owner and group (Optional)</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>9</td>
<td>ONTAP: Set exported Flexvol permissions (Optional)</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>10</td>
<td>Cinder: Update file permissions</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>11</td>
<td>Cinder: Verify mounts and permissions</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Table 4.11 Checklist to Enable NAS Security</p>
<p>1) Change NAS security
options.</p>
<p>Set the <code class="docutils literal notranslate"><span class="pre">nas_secure_file_operations</span></code> and <code class="docutils literal notranslate"><span class="pre">nas_secure_file_permissions</span></code> to specify
the NAS security mode. Make changes to /etc/cinder/cinder.conf in the backend’s
configuration stanza.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">nfs</span><span class="o">-</span><span class="n">backend</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">nas_secure_file_operations</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">nas_secure_file_permissions</span> <span class="o">=</span> <span class="n">true</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>2) Determine the cinder user’s
UID and GID.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ id -u cinder
500
$ id -g cinder
510
</pre></div>
</div>
</div></blockquote>
<p>3) Add users to cinder
group.</p>
<p>To have file access, Nova and Glance service users need to belong to the same
group as the Cinder user. This step needs to be performed on each node running
Nova or Glance services.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>...
$ usermod -a -G replace-with-cinder-GID nova
$ usermod -a -G replace-with-cinder-GID glance
...
$ id nova
uid=520(nova) gid=521(nova) groups=510(cinder),...
$ id glance
uid=530(glance) gid=531(glance) groups=510(cinder),...
...
</pre></div>
</div>
</div></blockquote>
<p>4) Change QEMU
configuration.</p>
<p>Certain compute operations (i.e. attaching a volume) require that Libvirt, Qemu,
and KVM run as a user belonging to the correct group. Edit the
/etc/libvirt/qemu.conf file and make the following changes.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="c1">#user = &quot;root&quot;</span>
<span class="n">user</span> <span class="o">=</span> <span class="s2">&quot;nova&quot;</span>
<span class="o">...</span>
<span class="c1">#group = &quot;root&quot;</span>
<span class="n">group</span> <span class="o">=</span> <span class="s2">&quot;cinder&quot;</span>
<span class="o">...</span>
<span class="c1">#dynamic_ownership = 1</span>
<span class="n">dynamic_ownership</span> <span class="o">=</span> <span class="mi">0</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">After making the configuration changes restart the needed libvirt, QEMU,
KVM processes or restart the hypervisor. The Nova services also need to
be restarted. This is a disruptive operation that may require planning
depending on your environment.</p>
</div>
<p>5) Edit the Domain setting for
idmapd (NFSv4.x only).</p>
<p>Idmapd is the NFSv4 bidirectional ID/name mapping daemon. The domain defined in
the /etc/idmapd.conf must match the NFS server domain. The first step is to
query ONTAP for the domain. The second step is to then edit the /etc/idmapd.conf
file and restart the idmapd service. This step is not necessary if using NFSv3.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">vserver</span> <span class="n">nfs</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">fields</span> <span class="n">v4</span><span class="o">-</span><span class="nb">id</span><span class="o">-</span><span class="n">domain</span>
<span class="o">...</span>
<span class="n">vserver</span>  <span class="n">v4</span><span class="o">-</span><span class="nb">id</span><span class="o">-</span><span class="n">domain</span>
<span class="o">--------</span> <span class="o">---------------------</span>
<span class="n">replace</span><span class="o">-</span> <span class="n">nfsv4domain</span><span class="o">.</span><span class="n">somewhere</span><span class="o">.</span><span class="n">com</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>Edit the /etc/idmapd.conf on the Cinder node:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">Domain</span> <span class="o">=</span> <span class="n">nfsv4domain</span><span class="o">.</span><span class="n">somewhere</span><span class="o">.</span><span class="n">com</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>6) Add nova, glance, and cinder users
to cinder GID.</p>
<p>If local files are used, then the cluster leverages the unix-user and unix-group
tables created for the specified SVM. The nova, glance, and cinder SVM users,
if they exist, need to belong to the same cinder GID (510) as used by the
cinder service. The nova and glance users can be created with the ONTAP CLI
<code class="docutils literal notranslate"><span class="pre">unix-user</span> <span class="pre">create</span> <span class="pre">command</span></code> if needed.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">unix</span><span class="o">-</span><span class="n">group</span> <span class="n">create</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">name</span> <span class="n">cinder</span> <span class="o">-</span><span class="nb">id</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">cinder</span><span class="o">-</span><span class="n">GID</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">unix</span><span class="o">-</span><span class="n">group</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span>
<span class="o">...</span>
<span class="n">Vserver</span>        <span class="n">Name</span>                <span class="n">ID</span>
<span class="o">--------------</span> <span class="o">-------------------</span> <span class="o">----------</span>
<span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span>  <span class="n">cinder</span>              <span class="mi">510</span>
<span class="o">...</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">unix</span><span class="o">-</span><span class="n">user</span> <span class="n">modify</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">user</span> <span class="n">nova</span> <span class="o">-</span><span class="n">primary</span><span class="o">-</span><span class="n">gid</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">cinder</span><span class="o">-</span><span class="n">GID</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">unix</span><span class="o">-</span><span class="n">user</span> <span class="n">modify</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">user</span> <span class="n">glance</span> <span class="o">-</span><span class="n">primary</span><span class="o">-</span><span class="n">gid</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">cinder</span><span class="o">-</span><span class="n">GID</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">unix</span><span class="o">-</span><span class="n">user</span> <span class="n">modify</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">user</span> <span class="n">cinder</span> <span class="o">-</span><span class="n">primary</span><span class="o">-</span><span class="n">gid</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">cinder</span><span class="o">-</span><span class="n">GID</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">unix</span><span class="o">-</span><span class="n">user</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span>
<span class="o">...</span>
               <span class="n">User</span>            <span class="n">User</span>   <span class="n">Group</span>  <span class="n">Full</span>
<span class="n">Vserver</span>        <span class="n">Name</span>            <span class="n">ID</span>     <span class="n">ID</span>     <span class="n">Name</span>
<span class="o">--------------</span> <span class="o">---------------</span> <span class="o">------</span> <span class="o">------</span> <span class="o">--------------------------------</span>
<span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span>  <span class="n">cinder</span>          <span class="mi">500</span>    <span class="mi">510</span>
<span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span>  <span class="n">nova</span>            <span class="mi">501</span>    <span class="mi">510</span>
<span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span>  <span class="n">glance</span>          <span class="mi">502</span>    <span class="mi">510</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">NetApp recommends leveraging either NIS or LDAP for name services in larger
environments.</p>
</div>
<p>7) Set exported Flexvol
owner and group.</p>
<p>Access to a Flexvol can be further restricted by only allowing a specific User
ID (UID) and Group ID (GID). The UID must match the cinder UID of the Cinder
node. The GID must match the cinder GID of the Cinder node.  In this example,
the UID is 500 and the GID is 510. These values will be different on your cinder
node and must be determined prior to running the following commands.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">volume</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">volume</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">name</span>
<span class="o">...</span>
<span class="n">User</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">Group</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">0</span>
<span class="o">...</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">volume</span> <span class="n">modify</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">volume</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">user</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">cinder</span><span class="o">-</span><span class="n">UID</span> <span class="o">-</span><span class="n">group</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">cinder</span><span class="o">-</span><span class="n">GID</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">volume</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">volume</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">name</span>
<span class="o">...</span>
<span class="n">User</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">500</span>
<span class="n">Group</span> <span class="n">ID</span><span class="p">:</span> <span class="mi">510</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>8) Set exported Flexvol
permissions.</p>
<p>Access can be further restricted by setting the UNIX permissions on a volume. In
this example we set the Flexvol permissions, of the shared volume, to 0755. This
step is optional.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">volume</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">volume</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">name</span>
<span class="o">...</span>
<span class="n">UNIX</span> <span class="n">Permissions</span><span class="p">:</span> <span class="o">---</span><span class="n">rwxrwxrwx</span>
<span class="o">...</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">volume</span> <span class="n">modify</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">volume</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">unix</span><span class="o">-</span><span class="n">permissions</span> <span class="mi">0755</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">volume</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">volume</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">volume</span><span class="o">-</span><span class="n">name</span>
<span class="o">...</span>
<span class="n">UNIX</span> <span class="n">Permissions</span><span class="p">:</span> <span class="o">---</span><span class="n">rwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>9) Update file permissions
to 0660.</p>
<p>Other OpenStack services (i.e. Nova and Glance) need “group” rw privileges in
order to access the cinder volumes. This is accomplished by running chmod 0660
on all files in the mount points. Verify that the IP address, of the mount point,
matches a LIF IP address of the correct SVM prior to executing the chmod and
chown commands. Order of operations are stop Cinder services, run chmod and
chown, and unmount mount points.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ systemctl stop openstack-cinder-{api,scheduler,volume}
$ mount
...
192.168.100.10:/cinder_flexvol_1 on /var/lib/cinder/mnt/69809486d67b39d4baa19744ef3ef90c type nfs (rw,...,addr=192.168.100.10)
192.168.100.10:/cinder_flexvol_2 on /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b type nfs (rw,...,addr=192.168.100.10)
...
$ cd /var/lib/cinder/mnt/69809486d67b39d4baa19744ef3ef90c
$ chmod -R 0660 *
$ chown -R cinder:cinder
$ cd /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b
$ chmod -R 0660 *
$ chown -R cinder:cinder
$ cd /var/lib/cinder/mnt
$ sudo umount 69809486d67b39d4baa19744ef3ef90c
$ sudo umount 5821d3908bfae68920f0c7be2dfc0c7b
</pre></div>
</div>
</div></blockquote>
<p>10) Disable superuser access in
export policy.</p>
<p>Disabling superuser access in the export policy is effectively the same as
enabling root squash. Any root access from a NFS client (i.e. UID 0) is remapped
to the anonymous user, default UID is 65534, when superuser access is disabled.
This step also disables set user ID (suid) access. The following example also
disables set user ID (suid) and set group ID (sgid) access.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">vserver</span> <span class="n">export</span><span class="o">-</span><span class="n">policy</span> <span class="n">rule</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">policyname</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">policy</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">fields</span> <span class="n">superuser</span><span class="p">,</span><span class="n">allow</span><span class="o">-</span><span class="n">suid</span>
<span class="o">...</span>
<span class="n">vserver</span>  <span class="n">policyname</span> <span class="n">ruleindex</span> <span class="n">superuser</span> <span class="n">allow</span><span class="o">-</span><span class="n">suid</span>
<span class="o">--------</span> <span class="o">----------</span> <span class="o">---------</span> <span class="o">---------</span> <span class="o">----------</span>
<span class="n">replace</span><span class="o">-</span> <span class="n">cinder</span>     <span class="mi">1</span>         <span class="nb">any</span>       <span class="n">true</span>
<span class="o">...</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">vserver</span> <span class="n">export</span><span class="o">-</span><span class="n">policy</span> <span class="n">rule</span> <span class="n">modify</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">policyname</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">policy</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">ruleindex</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">rule</span><span class="o">-</span><span class="n">index</span> <span class="o">-</span><span class="n">protocol</span> <span class="n">nfs</span> <span class="o">-</span><span class="n">superuser</span> <span class="n">none</span> <span class="o">-</span><span class="n">allow</span><span class="o">-</span><span class="n">suid</span> <span class="n">false</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">vserver</span> <span class="n">export</span><span class="o">-</span><span class="n">policy</span> <span class="n">rule</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">policyname</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">policy</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">fields</span> <span class="n">superuser</span><span class="p">,</span><span class="n">allow</span><span class="o">-</span><span class="n">suid</span>
<span class="o">...</span>
<span class="n">vserver</span>  <span class="n">policyname</span> <span class="n">ruleindex</span> <span class="n">superuser</span> <span class="n">allow</span><span class="o">-</span><span class="n">suid</span>
<span class="o">--------</span> <span class="o">----------</span> <span class="o">---------</span> <span class="o">---------</span> <span class="o">----------</span>
<span class="n">replace</span><span class="o">-</span> <span class="n">cinder</span>     <span class="mi">1</span>         <span class="n">none</span>      <span class="n">false</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>11) Verify mounts and
permissions.</p>
<p>In the previous step we unmounted the NFS mounts to prove that they are mounted
properly when the Cinder volume service starts. Verify this by starting Cinder
services, examining the Cinder volume service log, creating a new Cinder
volume, and listing the volume on the mount point.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ systemctl start openstack-cinder-{api,scheduler,volume}
$ cinder create --name test-vol-01 1
...
| id                             | 9c989cba-eff6-4847-b5fc-bff2ab5d35da |
...
$ ls -l /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b/volume-9c989cba-eff6-4847-b5fc-bff2ab5d35da
...
-rw-rw-rw- 1 root root 1073741824 Oct 12 13:15 /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b/volume-9c989cba-eff6-4847-b5fc-bff2ab5d35da
...
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="how-to-disable-nfs-security">
<h3>How to Disable NFS Security<a class="headerlink" href="#how-to-disable-nfs-security" title="Permalink to this headline">¶</a></h3>
<p>The following checklist provides a reference for disabling NFS security. Be
advised that some of the commands, shown in the examples, may differ depending
on your environment.</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="80%" />
<col width="12%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">#</th>
<th class="head">Description of Step</th>
<th class="head">Done?</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>1</td>
<td>Cinder: Update NAS security options</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>2</td>
<td>ONTAP: Allow Superuser access in export policy</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>3</td>
<td>Cinder: Update file permissions</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>4</td>
<td>Cinder: Delete .cinderSecureEnvIndicator file</td>
<td>&#160;</td>
</tr>
<tr class="row-even"><td>5</td>
<td>Cinder: Verify mounts and permissions</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Table 4.12 Checklist to Disable NFS Security</p>
<p>1) Update NAS Security
options.</p>
<p>Set the <code class="docutils literal notranslate"><span class="pre">nas_secure_file_operations</span></code> and <code class="docutils literal notranslate"><span class="pre">nas_secure_file_permissions</span></code> to
specify the NAS security mode. Make changes to /etc/cinder/cinder.conf in the
backend’s configuration stanza.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">nfs_backend</span><span class="p">]</span>
<span class="o">...</span>
<span class="n">nas_secure_file_operations</span> <span class="o">=</span> <span class="n">false</span>
<span class="n">nas_secure_file_permissions</span> <span class="o">=</span> <span class="n">false</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>2) Enable Superuser access
in the export policy.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">vserver</span> <span class="n">export</span><span class="o">-</span><span class="n">policy</span> <span class="n">rule</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">policyname</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">policy</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">fields</span> <span class="n">superuser</span>
<span class="o">...</span>
<span class="n">vserver</span>  <span class="n">policyname</span> <span class="n">ruleindex</span> <span class="n">superuser</span>
<span class="o">--------</span> <span class="o">----------</span> <span class="o">---------</span> <span class="o">---------</span>
<span class="n">replace</span><span class="o">-</span> <span class="n">cinder</span>     <span class="mi">1</span>         <span class="n">none</span>
<span class="o">...</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">vserver</span> <span class="n">export</span><span class="o">-</span><span class="n">policy</span> <span class="n">rule</span> <span class="n">modify</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">policyname</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">policy</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">ruleindex</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">rule</span><span class="o">-</span><span class="n">index</span> <span class="o">-</span><span class="n">protocol</span> <span class="n">nfs</span> <span class="o">-</span><span class="n">superuser</span> <span class="nb">any</span>
<span class="n">CDOT</span><span class="p">:</span><span class="o">&gt;</span> <span class="n">vserver</span> <span class="n">export</span><span class="o">-</span><span class="n">policy</span> <span class="n">rule</span> <span class="n">show</span> <span class="o">-</span><span class="n">vserver</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">vserver</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">policyname</span> <span class="n">replace</span><span class="o">-</span><span class="k">with</span><span class="o">-</span><span class="n">policy</span><span class="o">-</span><span class="n">name</span> <span class="o">-</span><span class="n">fields</span> <span class="n">superuser</span>
<span class="o">...</span>
<span class="n">vserver</span>  <span class="n">policyname</span> <span class="n">ruleindex</span> <span class="n">superuser</span>
<span class="o">--------</span> <span class="o">----------</span> <span class="o">---------</span> <span class="o">---------</span>
<span class="n">replace</span><span class="o">-</span> <span class="n">cinder</span>     <span class="mi">1</span>         <span class="nb">any</span>
<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
<p>3) Update file permissions
to 0666.</p>
<p>Other OpenStack services (i.e. Nova and Glance) need “world” rw privileges in
order to access the cinder volumes. This is accomplished by running chmod 0666
on all files in the mount points. Verify that the IP address, of the mount
point, matches a LIF IP address of the correct SVM prior to executing the chmod
and chown commands. Order of operations are stop Cinder services,
run chmod, unmount mount points, and start Cinder services.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ systemctl stop openstack-cinder-{api,scheduler,volume}
$ mount
...
192.168.100.10:/cinder_flexvol_1 on /var/lib/cinder/mnt/69809486d67b39d4baa19744ef3ef90c type nfs (rw,...,addr=192.168.100.10)
192.168.100.10:/cinder_flexvol_2 on /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b type nfs (rw,...,addr=192.168.100.10)
...
$ cd /var/lib/cinder/mnt/69809486d67b39d4baa19744ef3ef90c
$ chmod -R 0666 *
$ chown -R root:root
$ cd /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b
$ chmod -R 0666 *
$ chown -R root:root
$ cd /var/lib/cinder/mnt
$ sudo umount 69809486d67b39d4baa19744ef3ef90c
$ sudo umount 5821d3908bfae68920f0c7be2dfc0c7b
$ systemctl start openstack-cinder-{api,scheduler,volume}
</pre></div>
</div>
</div></blockquote>
<p>4) Delete the .cinderSecureEnvIndicator file
if it exists.</p>
<p>The Cinder volume service, under certain conditions, creates the
.cinderSecureEnvIndicator file as an indicator that NAS security is enabled.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mount
...
192.168.100.10:/cinder_flexvol_1 on /var/lib/cinder/mnt/69809486d67b39d4baa19744ef3ef90c type nfs (rw,...,addr=192.168.100.10)
192.168.100.10:/cinder_flexvol_2 on /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b type nfs (rw,...,addr=192.168.100.10)
...
$ cd /var/lib/cinder/mnt/69809486d67b39d4baa19744ef3ef90c
$ rm .cinderSecureEnvIndicator
$ cd /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b
$ rm .cinderSecureEnvIndicator
</pre></div>
</div>
</div></blockquote>
<p>5) Verify mounts and
permissions.</p>
<p>In the previous step we unmounted the NFS mounts to prove that they are mounted
properly when the Cinder volume service starts. Verify this by examining the
Cinder volume service log, creating a new Cinder volume, and listing the volume
on the mount point. It is recommended that Nova services be restarted followed
by verification that attaching a volume to a compute instance works.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cinder create --name test-vol-01 1
...
| id                             | 9c989cba-eff6-4847-b5fc-bff2ab5d35da |
...
$ ls -l /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b/volume-9c989cba-eff6-4847-b5fc-bff2ab5d35da
...
-rw-rw-rw- 1 root root 1073741824 Oct 12 13:15 /var/lib/cinder/mnt/5821d3908bfae68920f0c7be2dfc0c7b/volume-9c989cba-eff6-4847-b5fc-bff2ab5d35da
...
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>


              </div>
            </div>
          </div>
          <div class="docs-actions">
          
            <a href="section_vg-v-ddp.html"><i class="fa fa-angle-double-left" data-toggle="tooltip" data-placement="top" title="Previous: Deployment Choices: Volume Groups vs. Dynamic Disk Pools (E-Series)"></i></a>
          
          
            <a href="section_unidirectional-chap.html"><i class="fa fa-angle-double-right" data-toggle="tooltip" data-placement="top" title="Next: Deployment Choices: Unidirectional CHAP Authentication"></i></a>
          
            <a id="logABugLink3" href="" target="_blank" title="Found an error? Report a bug against this page"><i class="fa fa-bug" data-toggle="tooltip" data-placement="top" title="Report a Bug"></i></a>
          
          </div>
          <div class="row docs-byline bottom">
            <div class="docs-updated">updated: 2018-07-12 13:54</div>
          </div>
          <div class="row">
            <div class="col-lg-8 col-md-8 col-sm-8 docs-license">
<p>
 This document is licensed under
 <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>.
</p>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 docs-actions-wrapper">
            <!-- ID buglinkbottom added so that pre-filled doc bugs
                 are sent to Launchpad projects related to the
                 document -->
              <a href="#" id="logABugLink2" class="docs-footer-actions"><i class="fa fa-bug"></i> found an error? report a bug</a>
              <a href="http://netapp.io/slack/" class="docs-footer-actions"><i class="fa fa-question-circle"></i> questions?</a>
            </div>
          </div>
        </div>
<div class="col-lg-3 col-md-4 col-sm-4 col-lg-pull-9 col-md-pull-8 col-sm-pull-8 docs-sidebar">
  <div class="btn-group docs-sidebar-releases">
<a href="../../index.html">
  <button href="#" type="button"
          class="btn docs-sidebar-release-select">NetApp OpenStack Docs 2018.1</button>
</a>

  </div>
  <div class="docs-sidebar-toc">
    <div class="docs-sidebar-section" id="table-of-contents">
      <h4></h4>
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ch_executive-summary.html">Executive Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_openstack-overview.html">OpenStack Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_netapp-storage.html">NetApp Systems and Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendices/appendix_packaging.html">Installing OpenStack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_glance-image-service.html">Image Service (Glance)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_nova.html">Compute Service (Nova)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../ch_cinder.html">Block Storage (Cinder)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../overview/section_cinder-overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../key_concepts/section_cinder-key-concepts.html">Key Concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../process_structure/section_cinder-processes.html">Process Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_overview/section_cinder-api-overview.html">API Overview</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../ch_cinder-theory-and-deployment-choices.html">Theory of Operation and Deployment Choices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch_cinder-configuration.html">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ch_cinder-examples.html">Examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_manila.html">Shared Filesystems (Manila)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_swift.html">Object Storage (Swift)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_operations.html">Day two operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ch_appendix.html">Appendix</a></li>
</ul>

    </div>
  </div>
</div>
      </div>
    </div>
<footer>
  <div class="container">
    <div class="row footer-links">
      <div class="col-lg-2 col-sm-2">
        <h3>NetApp Resources</h3>
        <ul>
          <li><a href="http://netapp.io/openstack/#resources">NetApp OpenStack Resources</a></li>
          <li><a href="http://docs.netapp.com">NetApp documentation</a></li>
          <li><a href="http://www.netapp.com/us/media/tr-4620.pdf">NetApp SolidFire Storage Config Guide</a></li>
          <li><a href="https://mysupport.netapp.com/">NetApp Support</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>News</h3>
        <ul>
          <li><a href="http://netapp.io/blog/">Netapp's thePub</a></li>
          <li><a href="http://planet.openstack.org/">Community Blog</a></li>
          <li><a href="http://openstack.org/news/">Community News</a></li>
        </ul>
      </div>
      <div class="col-lg-2 col-sm-2">
        <h3>Social Media</h3>
        <ul>
          <li><a href="https://www.github.com/netapp">GitHub</a></li>
          <li><a href="http://netapp.io/slack">Slack</a></li>
          <li><a href="https://twitter.com/@openstacknetapp">Twitter @openstacknetapp</a></li>
          <li><a href="https://www.youtube.com/user/NetAppTV">Youtube NetAppTV</a></li>
        </ul>
      </div>
      <div class="col-lg-4 col-sm-4">
        <h3>Legal</h3>
        <p class="fine-print">
          The OpenStack project is provided under the
          <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 license</a>
        </p>
      </div>
    </div>
  </div>
</footer>
<!-- jQuery -->
<script type="text/javascript" src="../../_static/js/jquery-3.1.1.js"></script>

<!-- Bootstrap JavaScript -->
<script type="text/javascript" src="../../_static/js/bootstrap.js"></script>

<!-- The rest of the JS -->
<script type="text/javascript" src="../../_static/js/navigation.js"></script>

<!-- Docs JS -->
<script type="text/javascript" src="../../_static/js/docs.js"></script>

<!-- Popovers -->
<script type="text/javascript" src="../../_static/js/webui-popover.js"></script>

<!-- Javascript for page -->
<script language="JavaScript">
/* build a description of this page including SHA, source location on git repo,
   build time and the project's launchpad bug tag. Set the HREF of the bug
   buttons */

    var lineFeed = "%0A";
    var gitURL = "Source: Can't derive source file URL";

    /* there have been cases where "pagename" wasn't set; better check for it */
        /* The URL of the source file on Git is based on the giturl variable
           in conf.py, which must be manually initialized to the source file
           URL in Git.
           "pagename" is a standard sphinx parameter containing the name of
           the source file, without extension.                             */

        var sourceFile = "cinder/deployment_choice/section_nfs-security" + ".rst";
        gitURL = "Source: https://github.com/NetApp-openstack-dev/openstack-docs" + "/" + sourceFile;

    /* gitsha, project, bug_tag and watermark rely on variables in conf.py */
    var gitSha = "SHA: 21e604cfb2a3ddf2165b40d669d487f28d00b6df";
        var bugProject = "NetApp-openstack-dev/openstack-docs";
        var bugTitle = "Deployment Choices: NFS Security in NetApp OpenStack Docs";
    var fieldTags = "docs, dog";
    var watermark = "QUEENS"
        var useStoryboard = "";


    /* "last_updated" is the build date and time. It relies on the
       conf.py variable "html_last_updated_fmt", which should include
       year/month/day as well as hours and minutes                   */
    var buildstring = "Release: 2018.1 on 2018-07-12 13:54";

    var fieldComment = encodeURI(buildstring) +
                       lineFeed + encodeURI(gitSha) +
                       lineFeed + encodeURI(gitURL) ;

    logABug(bugTitle, bugProject, fieldComment, fieldTags, watermark);
</script>

  </body>
</html>